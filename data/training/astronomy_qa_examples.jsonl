{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "How do I select red giant branch stars from Gaia DR3 data?"}, {"role": "assistant", "content": "To select Red Giant Branch (RGB) stars from Gaia DR3, apply these color and magnitude cuts:\n\n**Recommended Selection Criteria:**\n```python\nfrom astroquery.gaia import Gaia\n\nquery = \"\"\"\nSELECT source_id, ra, dec, phot_g_mean_mag, bp_rp, parallax\nFROM gaiadr3.gaia_source\nWHERE parallax > 0.1\n  AND parallax_over_error > 5\n  AND phot_g_mean_mag < 15\n  AND bp_rp > 0.8\n  AND bp_rp < 1.8\n  AND phot_g_mean_mag - 5*LOG10(1000/parallax) + 5 BETWEEN 0 AND 3\n\"\"\"\nresult = Gaia.launch_job(query).get_results()\n```\n\n**Key cuts explained:**\n1. `bp_rp > 0.8`: Removes blue main sequence stars\n2. `bp_rp < 1.8`: Excludes very red AGB stars\n3. Absolute magnitude M_G between 0-3: RGB luminosity range\n4. `parallax_over_error > 5`: Quality cut for reliable distances\n\n**Contamination sources to watch:**\n- Red clump stars (horizontal branch) overlap at M_G ~ 0.5\n- AGB stars at redder colors\n- Background giants with poor parallax\n\nFor cleaner selection, consider adding proper motion cuts or using the Gaia XP spectra for spectroscopic confirmation."}]}
{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "Cross-match my source list at RA=150.2, Dec=2.5 with SDSS within 2 arcseconds"}, {"role": "assistant", "content": "I'll perform a cross-match with SDSS DR17 using astroquery:\n\n```python\nfrom astroquery.sdss import SDSS\nfrom astropy.coordinates import SkyCoord\nimport astropy.units as u\n\n# Define your position\ncoord = SkyCoord(ra=150.2, dec=2.5, unit='deg')\n\n# Query SDSS with 2 arcsec radius\nresult = SDSS.query_region(\n    coord,\n    radius=2*u.arcsec,\n    spectro=False,  # Set True if you want spectra\n    photoobj_fields=['objid', 'ra', 'dec', 'u', 'g', 'r', 'i', 'z', 'type', 'clean']\n)\n\nif result is not None:\n    print(f\"Found {len(result)} matches\")\n    print(result)\nelse:\n    print(\"No matches found within 2 arcsec\")\n```\n\n**For bulk cross-matching** (multiple sources):\n```python\nfrom astroquery.xmatch import XMatch\n\n# Your source table needs 'ra' and 'dec' columns\nresult = XMatch.query(\n    cat1=your_table,\n    cat2='vizier:V/154/sdss16',  # SDSS DR16 photometry\n    max_distance=2*u.arcsec,\n    colRA1='ra', colDec1='dec'\n)\n```\n\n**SDSS type codes:**\n- type=3: Galaxy\n- type=6: Star\n- clean=1: Reliable photometry\n\nThe match at (150.2, 2.5) is in the SDSS footprint (Stripe 82 region), so coverage should be good."}]}
{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "Generate a color-magnitude diagram for the globular cluster M13"}, {"role": "assistant", "content": "I'll create a CMD for M13 (NGC 6205) using Gaia DR3 data:\n\n```python\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom astroquery.gaia import Gaia\nfrom astropy.coordinates import SkyCoord\nimport astropy.units as u\n\n# M13 coordinates and properties\nm13_coord = SkyCoord.from_name('M13')\nradius = 20  # arcmin - covers the cluster\ndistance_modulus = 14.33  # (m-M)_0 for M13\n\n# Query Gaia DR3\nquery = f\"\"\"\nSELECT source_id, ra, dec, phot_g_mean_mag, bp_rp, \n       pmra, pmdec, parallax, parallax_error,\n       phot_bp_rp_excess_factor\nFROM gaiadr3.gaia_source\nWHERE CONTAINS(\n    POINT('ICRS', ra, dec),\n    CIRCLE('ICRS', {m13_coord.ra.deg}, {m13_coord.dec.deg}, {radius/60})\n) = 1\nAND phot_g_mean_mag < 21\nAND bp_rp IS NOT NULL\nAND ruwe < 1.4\n\"\"\"\n\njob = Gaia.launch_job_async(query)\ndata = job.get_results()\n\n# Proper motion selection for cluster members\n# M13: pmra ~ -3.2, pmdec ~ -2.6 mas/yr\npm_center_ra, pm_center_dec = -3.2, -2.6\npm_radius = 1.5  # mas/yr tolerance\n\nmembers = (\n    (data['pmra'] - pm_center_ra)**2 + \n    (data['pmdec'] - pm_center_dec)**2\n) < pm_radius**2\n\ncluster = data[members]\nfield = data[~members]\n\n# Create CMD\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 8))\n\n# Left: All sources\nax1.scatter(field['bp_rp'], field['phot_g_mean_mag'], \n            c='gray', s=1, alpha=0.3, label='Field')\nax1.scatter(cluster['bp_rp'], cluster['phot_g_mean_mag'],\n            c='blue', s=2, alpha=0.5, label='Members')\nax1.set_xlabel('BP - RP [mag]')\nax1.set_ylabel('G [mag]')\nax1.set_title('M13 Color-Magnitude Diagram')\nax1.invert_yaxis()\nax1.legend()\nax1.set_xlim(-0.5, 3)\nax1.set_ylim(21, 10)\n\n# Right: Absolute magnitude for members\nM_G = cluster['phot_g_mean_mag'] - distance_modulus\nax2.scatter(cluster['bp_rp'], M_G, c='blue', s=2, alpha=0.5)\nax2.set_xlabel('BP - RP [mag]')\nax2.set_ylabel('M$_G$ [mag]')\nax2.set_title('M13 CMD (Absolute Magnitude)')\nax2.invert_yaxis()\nax2.set_xlim(-0.5, 3)\nax2.set_ylim(8, -4)\n\n# Annotate features\nax2.annotate('RGB', xy=(1.2, -1), fontsize=10)\nax2.annotate('HB', xy=(0.0, 0.5), fontsize=10)\nax2.annotate('MS TO', xy=(0.4, 4), fontsize=10)\n\nplt.tight_layout()\nplt.savefig('m13_cmd.png', dpi=150)\nplt.show()\n\nprint(f\"Total sources: {len(data)}\")\nprint(f\"Cluster members: {len(cluster)}\")\n```\n\n**Key features visible in M13's CMD:**\n- **Main Sequence Turnoff** at G~18, BP-RP~0.4\n- **Subgiant Branch** rising from turnoff\n- **Red Giant Branch** from BP-RP 0.8 to 1.5\n- **Horizontal Branch** at M_G~0.5, extending blue\n- **AGB** above the HB at redder colors\n\nM13 is metal-poor ([Fe/H]~-1.5), so the RGB is relatively blue compared to metal-rich clusters."}]}
{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "Find recent papers about exoplanet atmospheres with JWST and format citations in AAS style"}, {"role": "assistant", "content": "I'll search NASA ADS for recent JWST exoplanet atmosphere papers:\n\n```python\nfrom astroquery.nasa_ads import ADS\nimport datetime\n\n# Configure ADS\nADS.TOKEN = 'your-ads-token'  # Get from ADS settings\nADS.NROWS = 10\nADS.ADS_FIELDS = ['bibcode', 'title', 'author', 'year', 'pub', 'citation_count', 'abstract']\nADS.SORT = 'citation_count desc'\n\n# Search query\nquery = 'JWST exoplanet atmosphere spectroscopy year:2023-2025'\nresults = ADS.query_simple(query)\n\nprint(f\"Found {len(results)} papers\\n\")\n\nfor i, paper in enumerate(results[:5]):\n    print(f\"{i+1}. {paper['title'][0]}\")\n    print(f\"   Authors: {', '.join(paper['author'][:3])} et al.\")\n    print(f\"   {paper['pub']} ({paper['year']})\")\n    print(f\"   Citations: {paper['citation_count']}\\n\")\n```\n\n**AAS Journal Citation Format:**\n\nFor ApJ, AJ, ApJL papers:\n```\nLastname, F. I., Lastname, F. I., & Lastname, F. I. Year, Journal, Volume, Page\n```\n\n**Example formatted citations:**\n\n```python\ndef format_aas_citation(paper):\n    \"\"\"Format a paper in AAS style.\"\"\"\n    authors = paper['author']\n    \n    if len(authors) <= 3:\n        author_str = ', '.join([a.split(',')[0] + ', ' + \n                                 a.split(',')[1].strip()[0] + '.' \n                                 for a in authors])\n    else:\n        first_author = authors[0].split(',')[0] + ', ' + authors[0].split(',')[1].strip()[0] + '.'\n        author_str = f\"{first_author}, et al.\"\n    \n    year = paper['year']\n    journal = paper['pub']\n    \n    # Extract volume and page from bibcode if available\n    bibcode = paper['bibcode']\n    \n    return f\"{author_str} {year}, {journal}\"\n\n# Generate citations\nfor paper in results[:5]:\n    print(format_aas_citation(paper))\n```\n\n**Sample recent high-impact papers:**\n\n1. JWST Transiting Exoplanet Community Early Release Science Team et al. 2023, Nature, 614, 649\n   - \"Identification of carbon dioxide in an exoplanet atmosphere\"\n\n2. Madhusudhan, N., et al. 2023, ApJL, 956, L13\n   - \"Carbon-bearing molecules in a possible hycean atmosphere\"\n\n**BibTeX export:**\n```python\nfrom astroquery.nasa_ads import ADS\n\n# Get BibTeX for a specific paper\nbibtex = ADS.get_bibtex('2023Natur.614..649J')\nprint(bibtex)\n```\n\nWant me to search for a more specific topic or time range?"}]}
{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "How do I perform aperture photometry on a FITS image?"}, {"role": "assistant", "content": "Here's a complete aperture photometry workflow using photutils:\n\n```python\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom astropy.io import fits\nfrom astropy.stats import sigma_clipped_stats, SigmaClip\nfrom astropy.wcs import WCS\nfrom photutils.detection import DAOStarFinder\nfrom photutils.aperture import CircularAperture, CircularAnnulus, aperture_photometry\nfrom photutils.background import Background2D, MedianBackground\nimport astropy.units as u\n\n# Load FITS image\nhdu = fits.open('image.fits')[0]\ndata = hdu.data.astype(float)\nheader = hdu.header\nwcs = WCS(header)\n\n# Get image properties\nif 'GAIN' in header:\n    gain = header['GAIN']  # e-/ADU\nelse:\n    gain = 1.0\n    print(\"Warning: GAIN not in header, assuming 1.0\")\n\n# 1. BACKGROUND ESTIMATION\nprint(\"Estimating background...\")\nsigma_clip = SigmaClip(sigma=3.0)\nbkg_estimator = MedianBackground()\nbkg = Background2D(data, (50, 50), filter_size=(3, 3),\n                   sigma_clip=sigma_clip, bkg_estimator=bkg_estimator)\n\ndata_sub = data - bkg.background\nmean, median, std = sigma_clipped_stats(data_sub, sigma=3.0)\nprint(f\"Background: {bkg.background_median:.2f} +/- {bkg.background_rms_median:.2f}\")\n\n# 2. SOURCE DETECTION\nprint(\"Detecting sources...\")\nfwhm = 4.0  # pixels - adjust based on your seeing\nthreshold = 5.0 * std  # 5-sigma detection\n\ndaofind = DAOStarFinder(fwhm=fwhm, threshold=threshold)\nsources = daofind(data_sub)\nprint(f\"Found {len(sources)} sources\")\n\n# 3. APERTURE PHOTOMETRY\nprint(\"Performing aperture photometry...\")\n\n# Aperture radii\nap_radius = 2.5 * fwhm / 2  # ~2.5x HWHM = good SNR\nsky_inner = 3.0 * fwhm\nsky_outer = 5.0 * fwhm\n\npositions = np.transpose((sources['xcentroid'], sources['ycentroid']))\n\n# Define apertures\napertures = CircularAperture(positions, r=ap_radius)\nannulus = CircularAnnulus(positions, r_in=sky_inner, r_out=sky_outer)\n\n# Photometry\nphot_table = aperture_photometry(data_sub, apertures)\nannulus_stats = aperture_photometry(data_sub, annulus)\n\n# Local background estimation from annulus\nbkg_mean = annulus_stats['aperture_sum'] / annulus.area\nbkg_in_aperture = bkg_mean * apertures.area\n\n# Background-subtracted flux\nphot_table['flux'] = phot_table['aperture_sum'] - bkg_in_aperture\nphot_table['flux_err'] = np.sqrt(\n    phot_table['flux'] / gain +  # Poisson noise from source\n    apertures.area * std**2 +     # Sky noise\n    apertures.area * (std**2 / annulus.area)  # Sky estimation error\n)\n\n# 4. CONVERT TO MAGNITUDES\nif 'EXPTIME' in header:\n    exptime = header['EXPTIME']\nelse:\n    exptime = 1.0\n\n# Instrumental magnitude\nphot_table['inst_mag'] = -2.5 * np.log10(phot_table['flux'] / exptime)\nphot_table['inst_mag_err'] = 1.0857 * phot_table['flux_err'] / phot_table['flux']\n\n# 5. PLOT RESULTS\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))\n\n# Show image with apertures\nim = ax1.imshow(data_sub, origin='lower', cmap='gray',\n                vmin=median-3*std, vmax=median+10*std)\napertures.plot(ax=ax1, color='red', lw=1.5)\nax1.set_title(f'Detected Sources (N={len(sources)})')\nplt.colorbar(im, ax=ax1, label='ADU')\n\n# Magnitude histogram\nax2.hist(phot_table['inst_mag'], bins=30, edgecolor='black')\nax2.set_xlabel('Instrumental Magnitude')\nax2.set_ylabel('Count')\nax2.set_title('Magnitude Distribution')\n\nplt.tight_layout()\nplt.savefig('photometry_results.png', dpi=150)\n\n# 6. SAVE CATALOG\nphot_table.write('photometry_catalog.fits', overwrite=True)\nprint(\"\\nPhotometry complete! Catalog saved.\")\nprint(phot_table[:5])\n```\n\n**Key parameters to tune:**\n- `fwhm`: Measure from stars using `photutils.centroids`\n- `threshold`: Lower = more detections, more noise\n- `ap_radius`: 2-3× FWHM captures ~95% of flux\n- Sky annulus: Far enough to avoid source flux\n\n**Aperture corrections** (for crowded fields):\n```python\nfrom photutils.psf import EPSFBuilder\n# Build empirical PSF from isolated stars\n# Apply correction: mag_corrected = mag_inst + ap_corr\n```\n\n**Calibration to standard system** requires observations of standard stars or cross-matching with calibrated catalogs (PS1, SDSS, 2MASS)."}]}
{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "Download Hubble images of the Crab Nebula from MAST"}, {"role": "assistant", "content": "I'll query and download HST images of the Crab Nebula (M1) from MAST:\n\n```python\nfrom astroquery.mast import Observations, Catalogs\nfrom astropy.coordinates import SkyCoord\nimport astropy.units as u\nimport os\n\n# Crab Nebula coordinates\ncrab = SkyCoord.from_name('M1')\nprint(f\"Crab Nebula: RA={crab.ra.deg:.4f}, Dec={crab.dec.deg:.4f}\")\n\n# 1. SEARCH FOR HST OBSERVATIONS\nprint(\"\\nSearching MAST for HST observations...\")\n\nobs_table = Observations.query_criteria(\n    coordinates=crab,\n    radius=5*u.arcmin,\n    obs_collection='HST',\n    dataproduct_type='image',\n    intentType='science'\n)\n\nprint(f\"Found {len(obs_table)} HST observations\")\n\n# Filter by instrument/filter\nprint(\"\\nAvailable instruments:\")\nprint(obs_table.group_by('instrument_name').groups.keys)\n\n# Get WFC3 observations\nwfc3_obs = obs_table[obs_table['instrument_name'] == 'WFC3/UVIS']\nprint(f\"\\nWFC3/UVIS observations: {len(wfc3_obs)}\")\n\n# Show available filters\nprint(\"\\nAvailable filters:\")\nfor obs in wfc3_obs[:10]:\n    print(f\"  {obs['obs_id']}: {obs['filters']} ({obs['t_exptime']:.1f}s)\")\n\n# 2. GET DATA PRODUCTS\nprint(\"\\nGetting data products...\")\n\n# Select specific observation (example: first WFC3 observation)\nselected_obs = wfc3_obs[0:1]  # Select first observation\n\ndata_products = Observations.get_product_list(selected_obs)\n\n# Filter for calibrated images (DRZ = drizzled, FLC = CTE-corrected)\ndrz_products = Observations.filter_products(\n    data_products,\n    productSubGroupDescription=['DRZ', 'DRC'],  # Drizzled products\n    extension='fits'\n)\n\nprint(f\"Found {len(drz_products)} drizzled products\")\nprint(drz_products['productFilename', 'size'])\n\n# 3. DOWNLOAD\nprint(\"\\nDownloading...\")\ndownload_dir = './crab_hst_data'\nos.makedirs(download_dir, exist_ok=True)\n\nmanifest = Observations.download_products(\n    drz_products,\n    download_dir=download_dir,\n    cache=True\n)\n\nprint(f\"\\nDownloaded {len(manifest)} files to {download_dir}\")\nfor f in manifest['Local Path']:\n    print(f\"  {f}\")\n```\n\n**Alternative: Download specific program data**\n```python\n# Search by proposal ID (e.g., famous Crab programs)\nobs_table = Observations.query_criteria(\n    coordinates=crab,\n    radius=5*u.arcmin,\n    proposal_id=['13401', '12535', '10526'],  # Known Crab programs\n    obs_collection='HST'\n)\n```\n\n**Quick method using astroquery.mast.Observations:**\n```python\n# One-liner to get all Crab HST data\nfrom astroquery.mast import Observations\n\nobs = Observations.query_object('M1', radius='5 arcmin')\nhst = obs[obs['obs_collection'] == 'HST']\n```\n\n**Notable HST Crab programs:**\n- **Proposal 13401**: WFC3 multiband (2014)\n- **Proposal 12535**: ACS monitoring\n- **Proposal 5204**: WFPC2 classic image\n\n**Data products explained:**\n- `_drz.fits`: Drizzle-combined image (use this)\n- `_flc.fits`: Individual CTE-corrected exposures\n- `_flt.fits`: Basic calibrated (no CTE correction)\n- `_raw.fits`: Uncalibrated\n\nWant me to also show how to make a color composite from multiple filters?"}]}
{"messages": [{"role": "system", "content": "You are an expert astronomy research assistant with deep knowledge of catalogs, data reduction, and astronomical analysis techniques."}, {"role": "user", "content": "Apply a color cut to select quasar candidates from SDSS photometry"}, {"role": "assistant", "content": "Here are standard color selection techniques for quasar candidates:\n\n```python\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom astroquery.sdss import SDSS\nfrom astropy.coordinates import SkyCoord\nimport astropy.units as u\n\n# Query a field for point sources with good photometry\nquery = \"\"\"\nSELECT TOP 50000\n    objid, ra, dec, \n    psfMag_u, psfMag_g, psfMag_r, psfMag_i, psfMag_z,\n    psfMagErr_u, psfMagErr_g, psfMagErr_r, psfMagErr_i, psfMagErr_z,\n    type, clean\nFROM PhotoObj\nWHERE \n    ra BETWEEN 150 AND 160\n    AND dec BETWEEN 0 AND 10\n    AND type = 6           -- Point sources (stars/QSOs)\n    AND clean = 1          -- Good photometry\n    AND psfMag_r BETWEEN 17 AND 21\n    AND psfMag_u > 0 AND psfMag_g > 0 AND psfMag_r > 0\n    AND psfMag_i > 0 AND psfMag_z > 0\n    AND psfMagErr_u < 0.2\n    AND psfMagErr_g < 0.1\n\"\"\"\n\nresult = SDSS.query_sql(query)\nprint(f\"Retrieved {len(result)} point sources\")\n\n# Calculate colors\nresult['u_g'] = result['psfMag_u'] - result['psfMag_g']\nresult['g_r'] = result['psfMag_g'] - result['psfMag_r']\nresult['r_i'] = result['psfMag_r'] - result['psfMag_i']\nresult['i_z'] = result['psfMag_i'] - result['psfMag_z']\n\n# =============================================================================\n# QUASAR COLOR SELECTIONS\n# =============================================================================\n\n# 1. UV-EXCESS SELECTION (z < 2.2 quasars)\n# Quasars are bluer in u-g than the stellar locus\nuv_excess = (\n    (result['u_g'] < 0.6) &\n    (result['g_r'] < 0.5) &\n    (result['g_r'] > -0.5)\n)\n\n# 2. RICHARDS+2002 ugri SELECTION\n# Classic SDSS quasar target selection\nrichards_lowz = (\n    (result['u_g'] < 0.6) &\n    (result['u_g'] > -0.5) &\n    (result['g_r'] < 0.6) &\n    (result['g_r'] > -0.5) &\n    (result['r_i'] < 0.4) &\n    (result['r_i'] > -0.5)\n)\n\n# 3. HIGH-Z QUASAR SELECTION (z > 3)\n# Dropout technique - Lyman-alpha enters g-band\nhigh_z_dropout = (\n    (result['u_g'] > 1.5) &  # u-band dropout\n    (result['g_r'] < 1.0) &\n    (result['g_r'] > -0.5)\n)\n\n# 4. MID-Z SELECTION (z ~ 2.5-3.5)\n# Between low-z and dropout regimes\nmid_z = (\n    (result['u_g'] > 0.6) &\n    (result['u_g'] < 1.5) &\n    (result['g_r'] > -0.2) &\n    (result['g_r'] < 0.8)\n)\n\n# Combined selection\nqso_candidates = uv_excess | high_z_dropout | mid_z\n\nprint(f\"\\nQuasar candidates:\")\nprint(f\"  UV-excess (z<2.2): {uv_excess.sum()}\")\nprint(f\"  High-z dropout (z>3): {high_z_dropout.sum()}\")\nprint(f\"  Mid-z (2.5<z<3.5): {mid_z.sum()}\")\nprint(f\"  Total unique: {qso_candidates.sum()}\")\n\n# =============================================================================\n# DIAGNOSTIC COLOR-COLOR PLOTS\n# =============================================================================\nfig, axes = plt.subplots(1, 3, figsize=(15, 5))\n\n# u-g vs g-r\nax1 = axes[0]\nax1.scatter(result['g_r'], result['u_g'], c='gray', s=1, alpha=0.3, label='All')\nax1.scatter(result['g_r'][qso_candidates], result['u_g'][qso_candidates], \n            c='red', s=5, alpha=0.7, label='QSO candidates')\nax1.set_xlabel('g - r')\nax1.set_ylabel('u - g')\nax1.set_title('u-g vs g-r')\nax1.axhline(0.6, color='blue', ls='--', alpha=0.5)\nax1.axhline(1.5, color='green', ls='--', alpha=0.5)\nax1.legend()\nax1.set_xlim(-1, 2.5)\nax1.set_ylim(-1, 3)\n\n# g-r vs r-i\nax2 = axes[1]\nax2.scatter(result['r_i'], result['g_r'], c='gray', s=1, alpha=0.3)\nax2.scatter(result['r_i'][qso_candidates], result['g_r'][qso_candidates],\n            c='red', s=5, alpha=0.7)\nax2.set_xlabel('r - i')\nax2.set_ylabel('g - r')\nax2.set_title('g-r vs r-i')\nax2.set_xlim(-0.5, 1.5)\nax2.set_ylim(-0.5, 2)\n\n# r-i vs i-z (for high-z)\nax3 = axes[2]\nax3.scatter(result['i_z'], result['r_i'], c='gray', s=1, alpha=0.3)\nax3.scatter(result['i_z'][qso_candidates], result['r_i'][qso_candidates],\n            c='red', s=5, alpha=0.7)\nax3.set_xlabel('i - z')\nax3.set_ylabel('r - i')\nax3.set_title('r-i vs i-z')\nax3.set_xlim(-0.5, 1)\nax3.set_ylim(-0.5, 1.5)\n\nplt.tight_layout()\nplt.savefig('qso_color_selection.png', dpi=150)\nplt.show()\n\n# Save candidates\ncandidates = result[qso_candidates]\ncandidates.write('qso_candidates.fits', overwrite=True)\nprint(f\"\\nSaved {len(candidates)} candidates to qso_candidates.fits\")\n```\n\n**Contamination and follow-up:**\n- White dwarfs: similar u-g but different g-r-i\n- Compact galaxies: Check morphology (type=6 helps)\n- A/F stars: Check proper motion (QSOs have μ~0)\n\n**Improve purity with:**\n1. WISE mid-IR colors (W1-W2 > 0.8 for AGN)\n2. Variability from multi-epoch data\n3. Gaia proper motion (QSOs are stationary)\n4. X-ray counterparts"}]}
